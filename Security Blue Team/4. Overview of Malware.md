Malware - The name is derived from malicious software, which is any program that has been created for malicious purposes, such as encrypting files or stealing passwords.

Backdoor Malicious code that installs itself onto a computer to allow the attacker access. Backdoors usually let the attacker connect to the computer with little or no authentication and execute commands on the local system.

Botnet Similar to a backdoor, in that it allows the attacker access to the system, but all computers infected with the same botnet receive the same instructions from a single command-and-control server.

Downloader Malicious code that exists only to download other malicious code. Downloaders are commonly installed by attackers when they first gain access to a system. The downloader program will download and install additional malicious code.

Information-stealing malware Malware that collects information from a victim’s computer and usually sends it to the attacker. Examples include sniffers, password hash grabbers, and keyloggers. This malware is typically used to gain access to online accounts such as email or online banking.

Launcher Malicious program used to launch other malicious programs. Usually, launchers use nontraditional techniques to launch other malicious programs in order to ensure stealth or greater access to a system.

Rootkit Malicious code designed to conceal the existence of other code. Rootkits are usually paired with other malware, such as a backdoor, to allow remote access to the attacker and make the code difficult for the victim to detect.

Scareware Malware designed to frighten an infected user into buying something. It usually has a user interface that makes it look like an antivirus or other security program. It informs users that there is malicious code on their system and that the only way to get rid of it is to buy their “software,” when in reality, the software it’s selling does nothing more than remove the scareware.

Spam-sending malware Malware that infects a user’s machine and then uses that machine to send spam. This malware generates income for attackers by allowing them to sell spam-sending services.

Worm or virus Malicious code that can copy itself and infect additional computers.

## How to Hunt for Malware??
we will cover how to use Mandiant Redline to audit systems, but before that, we want to make sure you’re familiar with what hunting for malware with IOCs actually includes. We are collecting and using indicators of compromise so that we can identify any presence of them within a system. There are two main things we’ll be looking for when hunting on endpoints:

- **Covert malware found using IOCs shared with the hunter** (usually from a Threat Intelligence team). This is what we’re providing an insight to with this course.
- **Comparing known-good values against systems to check for any differences**. An example of this would be comparing properties of Windows processes to see if they have been altered. For example, we could create an IOC file that has the file hashes of important processes such as winlogon.exe, smss.exe and others. Obviously this would alert these files to us, because they should match – so we would set the IOC value to “IS NOT”. If any files with important names do not match their official hash, we know that they have been modified or replaced, and this is something we would look into more.

## Mandiant Redline
Mandiant Redline is a “free endpoint security tool, that provides host investigative capabilities to users to find signs of malicious activity through memory and file analysis and the development of a threat assessment profile”. Mandiant Redline is only designed for Windows OS, so you’ll either need to [download a free Windows 10 disk image](https://developer.microsoft.com/en-us/windows/downloads/virtual-machines) or use your host if you run Windows (we won’t be handling real malware yet so you’re safe!). You can view the tool page for Mandiant Redline [here](https://www.fireeye.com/services/freeware/redline-download-confirmation.html) – which provides information on the features and allows you to [download](https://fireeye.market/apps/211364) it.

Whilst Redline can be used for a number of tasks, we will specifically be using it for the following:

- “Perform Indicators of Compromise (IOC) analysis. Supplied with a set of IOCs, the Redline Portable Agent is automatically configured to gather the data required to perform the IOC analysis and an IOC hit result review”

## **Installation**

[Download](https://www.fireeye.com/services/freeware/redline-download-confirmation.html) the .zip archive from FireEye’s website, extract it, and run the .msi file to install Redline. Open up Redline, and follow the next steps to import an IOC file (I’m using the IOC file we created in the previous section for the image file):

1. Click “Create an IOC Search Collector”
2. Click “Browse” in the top right corner
3. Find your folder named “IOCs” and click “Select Folder”
4. Select your IOC file in the left-hand window, then click “Next” in the bottom right corner

  
![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/files/b821dd8c94a4d224e32155805a143ede1972bfed38b947129e8ff95683b15a0b37e69b0dac370722e6789615870f.gif)

## **Getting Ready For The Hunt**

Now that you’ve selected your IOC file, you should see the below screen asking you to select a location to save your IOC Collector. Before going any further, we need to go into “Edit your script” to select our file enumeration. Go under “disk” and select the boxes that are marked below. Now create an empty folder, as Redline requires a base location to save all of its files and results from the hunt. Navigate anywhere and create a new folder called “Test Hunt 1”. Once you’ve done this, we can click the “Browse” button and select the new folder. Next, a popup will tell you that the Collector package has been created and saved to the location we selected.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/files/f3856c9d211861624846c43da8c54c80a6c3ac9e5190d0fbb82526d1551772930a653318d597380acf51e9f52e5b.png)

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/files/3be7ad351379dcfc55e3ab9a2799c68c7437c3dfb3624ea4d5147d966b6effe94b4581e798f14a3ac722da40848d.png)

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/1ff7adbceb8cbe91a0e026b7b820249b59d7908b528f05fb72ae976a7d18d6fb8a68c8adeb9bd83e2a5959440b35.png)

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/fed20cdd5e977b084277f342cf609e4fd5c658bd9e7c123fafd1ed0a65eb3e0a4a23765d952059acd07756ac757e.png)

## **Pre-Hunt Brief**

So let’s recap what we’ve done so far, and what we’re about to do. In the previous course section, we created an IOC file for an image named **clint-patterson-dYEuFB8KQJk-unsplash.jpg**. We gathered the MD5 hash, SHA-1 hash, file name, and file size. We then imported this IOC file into the auditing tool Redline and created an IOC Collector package which consists of scripts that will assess our target machine to identify files that match any of the indicators of compromise we have provided. We are looking for the below values

- **File Size Value = 1057889**
- **File Name Value = clint-patterson-dYEuFB8KQJk-unsplash.jpg**
- **MD5 Hash = 81ef348226632fb1061d22d4e6fd3479**
- **SHA-1 Hash = 173b0434341b25fb17c4b2829f8058b29738faef**

For this example assessment, I have hidden the exact same image file in 3 different locations on my host Windows system. However, I’ve made some changes so that they’re not all the same:

- **The first file has the exact same values as mentioned above** (we should detect it from all IOCs)
- **The second file has a different MD5/SHA-1 hashes, and file size, as I have added some random characters into the file** (we should detect it from the filename)
- **The last file has an altered file name** (we should detect it from the MD5 and SHA-1 hashes, and the file size)

## **Hunting with IOCs**

We have our IOCs. We have our IOC Collector base. We’re ready to hunt the system using Redline to detect the presence of our indicators of compromise. Navigate to your hunting folder, and you should see all of the collector’s files as shown below.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/e98e714e96f0c3b4f53876c1afb74516175d5ac843c62571cf5d4e8a798fb0ec0a42830ec7ce0a239ffefdf31722.png)

Now it’s time to start the audit. Type “CMD” into the Windows search bar and right-click > run as administrator. This is important because Redline needs to run as an Administrator in order to conduct all of its searches without being interrupted or denied access to certain locations. Now navigate to your hunting folder using “cd” to change directories. Starting at C:/ I had to use the following commands: `**cd Users**` > `**cd JBeam**` > `**cd Documents**` > `**cd "Test Hunt 1"**`. Once you’re in the same location as the collector files, use the command `**.\RunRedlineAudit.bat**`

When you run this script Redline will get to work. You should see a new directory appear in the Collector folder named “**Sessions**“, a sub-folder named “**AnalysisSession1**“, and a file sub-folder called “**Audits**“. Keep refreshing this location (right-click anywhere > refresh) and you should see the size of the XML file increase, and eventually stop. The Date Modified value is useful to tell if the audit is ongoing or has finished.

When the audit has completely finished in the “**AnalysisSession1**” directory you will see new files appear, similar to the below screenshot. We will be using AnalysisSession1.mans to import back into Redline, allowing us to generate an IOC Report and see what we found.

  
![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/736f790c3a7332daac381019e24001c4c3776d67ff063734b89f83192b0a179dc7483a2e7b7b3ababac017cb15bb.png)

Open up Redline, under the **Analyze Data** heading, click on **Open Previous Analysis**. Select your AnalysisSession1.mans file, and it will be loaded into Redline for analysis. In the bottom left corner you will see three tabs. Click on IOC Reports, and you should see a report from your hunt (if you don’t, give Redline some time to finish creating the report – you should see a popup at the bottom of the tool showing that it is working on it). Click on the IOC Report, then “**View Hits +**” on the right to view the results.

  
 

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/f587fb0df737bc5f6a56ecb966b93e4e94a013bddd3d94650bfd3bce93c4ffcf7b951a5c48cd95fb8b7ed63e610f.png)

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/9987521e4814a0fc6e2bc16efe186bfc63a0c37c23deb54276f1ef4815a4226afeaf389f2f7c1ee9871d0ed34a50.png)

We’ve done it! Redline has successfully found all of our files based on the provided IOCs, including the original and two modified versions. We are able to see the file path, size, MD5 hash, user, and various important file dates.

  
![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/8856efaf5e814bc2716f5c5f9c6636b429bd57322092b1d1a28c70e4f5bc472b2e28248e9a3f0318e29754f8b9cb.png)

## **Conclusion**

The same process above applies to hunting for live malware too. We would obtain IOCs either by performing our own analysis of malware samples, by retrieving IOCs from government-issued security alerts (such as DHS, NCSC, NCCIC, and UK/US-CERT), or from information-sharing groups usually formed between companies operating in the same industries. Just to provide an example, if Company A experiences a cyber-attack and they perform analysis and retrieve IOCs from the malware, they can share this with Company B and Company C, who can use an auditing tool like Redline to check their systems for any presence. Whilst Redline is an old tool, and limited in the sense that it can only be used on live machines using local admin access (as opposed to remotely conducting audits from a central server), it is a good tool to learn and understand the fundamentals of Threat Hunting.
